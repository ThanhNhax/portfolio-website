name: Next.js CI/CD to vercel

on:
  push:
    branches: ["master"]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci

      # vercel pull KHÔNG dùng project-id trong CLI v49
      - name: Pull Vercel Environment
        run: |
          npx vercel pull --yes \
            --environment=production \
            --token=${{ secrets.TOKEN_VERCEL }}

      - name: Build with Vercel
        run: |
          npx vercel build --prod \
            --token=${{ secrets.TOKEN_VERCEL }} \
            --project-id=prj_jl9kX7MSWUS9Tj9VS3GO0Uiqh5oV \
            --org-id=team_B7oVpgHxww1JYMrfu0ISwGSG

      - name: Deploy to Vercel
        run: |
          npx vercel deploy --prebuilt --prod \
            --token=${{ secrets.TOKEN_VERCEL }} \
            --project-id=prj_jl9kX7MSWUS9Tj9VS3GO0Uiqh5oV \
            --org-id=team_B7oVpgHxww1JYMrfu0ISwGSG
